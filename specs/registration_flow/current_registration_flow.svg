<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2408px" preserveAspectRatio="none" style="width:944px;height:2408px;" version="1.1" viewBox="0 0 944 2408" width="944px" zoomAndPan="magnify"><defs><filter height="300%" id="fwe8qwwtp0eqh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="469" cy="18" fill="#000000" filter="url(#fwe8qwwtp0eqh)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="405.5" y="2267"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="405.5" x2="532.5" y1="2293.2969" y2="2293.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="415.5" y="2284.9951">UserIsLoggedIn</text><ellipse cx="469" cy="2387" fill="none" filter="url(#fwe8qwwtp0eqh)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="469.5" cy="2387.5" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="2119.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="926" x="6" y="88"/><rect fill="#FFFFFF" height="2087" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="920" x="9" y="117.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="6" x2="932" y1="114.2969" y2="114.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="415.5" y="105.9951">RegisterScreen</text><ellipse cx="365" cy="166.2969" fill="#000000" filter="url(#fwe8qwwtp0eqh)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="106.1406" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="291.5" y="242.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291.5" x2="438.5" y1="268.5938" y2="268.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="309.5" y="260.292">BasicInfoScreen</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="296.5" y="284.7324">Firstname Lastname</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="296.5" y="298.7012">phonenumber</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="296.5" y="312.6699">emailaddress</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="60" x="296.5" y="326.6387">password</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="106" x="296.5" y="340.6074">confirmpassword</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="106.1406" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="208" y="439.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208" x2="348" y1="465.5938" y2="465.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="231" y="457.292">BasicInfoValid</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="42" x="213" y="481.7324">Check:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="62" x="245" y="495.7012">Firstname</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="61" x="245" y="509.6699">Lastname</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="245" y="523.6387">phonenumber</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="245" y="537.6074">emailaddress</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="171" y="667.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="171" x2="385" y1="693.5938" y2="693.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="196.5" y="685.292">GetRegistrationSession</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="194" x="176" y="709.7324">Creates new if it does not exist</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="268" x="144" y="754.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="144" x2="412" y1="780.5938" y2="780.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="218" y="772.292">LoadUserFromDb</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="248" x="149" y="796.7324">Use username from registrationsession</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="73.5" y="857.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="73.5" x2="246.5" y1="883.5938" y2="883.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="83.5" y="875.292">CreateNewUserObject</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="264.5" y="857.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="264.5" x2="411.5" y1="883.5938" y2="883.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="274.5" y="875.292">UpdateUserObject</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="236" y="960.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="236" x2="440" y1="986.5938" y2="986.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="184" x="246" y="978.292">UpsertUsernamePassword</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="282" x="197" y="1047.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197" x2="479" y1="1073.5938" y2="1073.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="260.5" y="1065.292">CheckValidatingPhone</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="234" x="202" y="1089.7324">Start phone validation if number from</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="262" x="202" y="1103.7012">basic info screen does not match number</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="202" y="1117.6699">from registration session cookie and</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="200" x="202" y="1131.6387">set cookie value to new number</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="267" x="204.5" y="1176.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="204.5" x2="471.5" y1="1202.5938" y2="1202.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="265" y="1194.292">CheckValidatingEmail</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="212" x="209.5" y="1218.7324">Start email validation if email from</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="247" x="209.5" y="1232.7012">basic info screen does not match email</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="209.5" y="1246.6699">from registration session cookie and</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="200" x="209.5" y="1260.6387">set cookie value to new number</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="253.5" y="1321.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="253.5" x2="422.5" y1="1347.5938" y2="1347.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="274" y="1339.292">ValidateInfoScreen</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="258.5" y="1363.7324">phone code</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="258.5" y="1377.7012">email verification status</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="231" x="427.5" y="1438.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="658.5" y1="1464.5938" y2="1464.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="211" x="437.5" y="1456.292">GetRegistrationSessionCookie</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="190" x="451" y="1541.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="451" x2="641" y1="1567.5938" y2="1567.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="461" y="1559.292">CheckIfPhoneIsValidated</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="461" y="1644.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="461" x2="649" y1="1670.5938" y2="1670.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="499.5" y="1662.292">CheckSMSCode</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="466" y="1686.7324">From the validate info form</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="244" x="353" y="1834.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="353" x2="597" y1="1860.5938" y2="1860.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="363" y="1852.292">CheckIfValidatedEmailIsRequired</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="249" x="336.5" y="1747.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="336.5" x2="585.5" y1="1773.5938" y2="1773.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="229" x="346.5" y="1765.292">CheckIfPhoneValidationIsSkipped</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="78.2031" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="394" x="393" y="127.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="393" x2="787" y1="153.5938" y2="153.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="180" x="500" y="145.292">IfValidatedEmailIsRequired</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="149" x="398" y="169.7324">No clientid query param</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="237" x="398" y="183.7012">user:validated:email scope requested</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="374" x="398" y="197.6699">requirevalidatedemail queryparam set with non empty value</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="222" x="217" y="1937.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="217" x2="439" y1="1963.5938" y2="1963.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="161" x="247.5" y="1955.292">CheckIfEmailIsValidated</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="129" x="222" y="1979.7324">Must be validated by</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="202" x="222" y="1993.7012">pressing the button in the email</text><rect fill="#FEFECE" filter="url(#fwe8qwwtp0eqh)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="250" x="290" y="2054.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="290" x2="540" y1="2080.5938" y2="2080.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="230" x="300" y="2072.292">DeleteRegistrationSessionValues</text><ellipse cx="415" cy="2182.2969" fill="none" filter="url(#fwe8qwwtp0eqh)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="415.5" cy="2182.7969" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><!--link *start*RegisterScreen to BasicInfoScreen--><path d="M365,176.4193 C365,189.6167 365,213.7482 365,236.838 " fill="none" id="*start*RegisterScreen-BasicInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="365,242.0538,369,233.0538,365,237.0538,361,233.0538,365,242.0538" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BasicInfoScreen to BasicInfoValid--><path d="M292.429,348.6704 C286.8476,354.2792 281.604,360.1801 277,366.2969 C262.6904,385.3083 260.7215,410.9116 263.1897,434.0728 " fill="none" id="BasicInfoScreen-BasicInfoValid" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="263.8225,439.2821,266.7079,429.8654,263.2195,434.3186,258.7663,430.8302,263.8225,439.2821" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BasicInfoScreen to BasicInfoValid--><path d="M322.5619,352.7575 C316.0371,363.2367 309.8647,374.3326 305,385.2969 C297.502,402.1963 291.8202,421.5592 287.6509,439.127 " fill="none" id="BasicInfoScreen-BasicInfoValid" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="325.377,348.3063,317.1857,353.7746,322.7044,352.532,323.9469,358.0508,325.377,348.3063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="306" y="398.3638">Basic info not valid</text><!--link BasicInfoValid to GetRegistrationSession--><path d="M278,545.3681 C278,582.6721 278,631.2442 278,662.1088 " fill="none" id="BasicInfoValid-GetRegistrationSession" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="278,667.2821,282,658.2821,278,662.2821,274,658.2821,278,667.2821" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="296.5" y="595.3638">Basic info valid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="279" y="610.4966">Generate username</text><!--link GetRegistrationSession to LoadUserFromDb--><path d="M278,717.4609 C278,727.29 278,738.6479 278,748.9265 " fill="none" id="GetRegistrationSession-LoadUserFromDb" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="278,754.1894,282,745.1894,278,749.1894,274,745.1894,278,754.1894" style="stroke: #A80036; stroke-width: 1.0;"/><!--link LoadUserFromDb to CreateNewUserObject--><path d="M230.1262,804.3945 C221.6886,809.7725 213.2851,815.8095 206,822.2969 C195.9617,831.2361 186.5936,842.6246 178.9659,853.0725 " fill="none" id="LoadUserFromDb-CreateNewUserObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="176.0228,857.1755,184.5187,852.1936,178.937,853.1126,178.0181,847.5308,176.0228,857.1755" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="207" y="835.3638">user not found</text><!--link LoadUserFromDb to UpdateUserObject--><path d="M292.6777,804.4935 C301.1038,818.9584 311.7343,837.2075 320.5818,852.3957 " fill="none" id="LoadUserFromDb-UpdateUserObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="323.2659,857.0034,322.1919,847.2132,320.7491,852.683,315.2793,851.2402,323.2659,857.0034" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="313" y="835.3638">user exists</text><!--link CreateNewUserObject to UpsertUsernamePassword--><path d="M203.5437,907.4935 C229.7159,922.6381 263.0571,941.9311 289.9903,957.516 " fill="none" id="CreateNewUserObject-UpsertUsernamePassword" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="294.5977,960.1821,288.8113,952.2123,290.27,957.6778,284.8045,959.1365,294.5977,960.1821" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UpdateUserObject to UpsertUsernamePassword--><path d="M338,907.4935 C338,921.8337 338,939.8931 338,955.0022 " fill="none" id="UpdateUserObject-UpsertUsernamePassword" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="338,960.0034,342,951.0034,338,955.0034,334,951.0034,338,960.0034" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UpsertUsernamePassword to BasicInfoScreen--><path d="M385.7149,960.1932 C412.2615,942.4609 440,915.8941 440,882.2969 C440,393.7969 440,393.7969 440,393.7969 C440,379.0242 434.594,365.0839 426.6847,352.5938 " fill="none" id="UpsertUsernamePassword-BasicInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="423.9106,348.4145,425.5552,358.1251,426.6757,352.5803,432.2205,353.7009,423.9106,348.4145" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="441" y="645.3638">Password invalid</text><!--link UpsertUsernamePassword to CheckValidatingPhone--><path d="M338,1010.3457 C338,1019.8563 338,1031.0678 338,1042.1212 " fill="none" id="UpsertUsernamePassword-CheckValidatingPhone" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="338,1047.1819,342,1038.1819,338,1042.1819,334,1038.1819,338,1047.1819" style="stroke: #A80036; stroke-width: 1.0;"/><!--link CheckValidatingPhone to CheckValidatingEmail--><path d="M338,1139.5045 C338,1149.6936 338,1160.5467 338,1170.926 " fill="none" id="CheckValidatingPhone-CheckValidatingEmail" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="338,1175.9783,342,1166.9783,338,1170.9783,334,1166.9783,338,1175.9783" style="stroke: #A80036; stroke-width: 1.0;"/><!--link CheckValidatingEmail to ValidateInfoScreen--><path d="M338,1268.4826 C338,1283.9657 338,1301.0302 338,1315.7682 " fill="none" id="CheckValidatingEmail-ValidateInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="338,1321.0855,342,1312.0855,338,1316.0855,334,1312.0855,338,1321.0855" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="339" y="1299.3638">Save registration session cookie</text><!--link ValidateInfoScreen to BasicInfoScreen--><path d="M253.2411,1336.1038 C158.1382,1314.3194 17,1273.3842 17,1222.2969 C17,393.7969 17,393.7969 17,393.7969 C17,338.2239 183.3809,312.4096 286.0538,301.7703 " fill="none" id="ValidateInfoScreen-BasicInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="291.1982,301.2444,281.838,298.1805,286.2241,301.7529,282.6517,306.139,291.1982,301.2444" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="18" y="783.8638">Basic info button</text><!--link ValidateInfoScreen to GetRegistrationSessionCookie--><path d="M387.1296,1385.3715 C405.5949,1396.9248 426.9679,1409.7114 447,1420.2969 C457.2429,1425.7096 468.3044,1431.0801 479.1497,1436.0971 " fill="none" id="ValidateInfoScreen-GetRegistrationSessionCookie" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="483.7815,1438.2247,477.2728,1430.833,479.2379,1436.1375,473.9334,1438.1027,483.7815,1438.2247" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="448" y="1416.3638">Register button</text><!--link GetRegistrationSessionCookie to BasicInfoScreen--><path d="M549.4984,1438.1477 C554.6543,1415.9749 561,1382.7107 561,1353.2969 C561,393.7969 561,393.7969 561,393.7969 C561,338.5306 498.0158,314.2698 443.4559,303.6216 " fill="none" id="GetRegistrationSessionCookie-BasicInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="438.5408,302.6942,446.643,308.2937,443.4541,303.6213,448.1264,300.4324,438.5408,302.6942" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="562" y="835.3638">Registration session expired</text><!--link GetRegistrationSessionCookie to CheckIfPhoneIsValidated--><path d="M543.2518,1488.4066 C543.4027,1499.1541 543.6383,1511.8427 544,1523.2969 C544.1323,1527.4846 544.3025,1531.9003 544.4878,1536.2434 " fill="none" id="GetRegistrationSessionCookie-CheckIfPhoneIsValidated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="544.7107,1541.2903,548.3092,1532.1224,544.4898,1536.2952,540.3171,1532.4757,544.7107,1541.2903" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="545" y="1519.3638">Load saved values from cookie</text><!--link CheckIfPhoneIsValidated to CheckSMSCode--><path d="M548.2016,1591.4935 C549.4547,1605.8337 551.0327,1623.8931 552.3529,1639.0022 " fill="none" id="CheckIfPhoneIsValidated-CheckSMSCode" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="552.7899,1644.0034,555.9909,1634.6892,552.3545,1639.0224,548.0213,1635.3859,552.7899,1644.0034" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="552" y="1622.3638">phone not validated yet</text><!--link CheckSMSCode to ValidateInfoScreen--><path d="M511.1266,1644.279 C471.6286,1619.1737 415.6675,1576.6236 388,1523.2969 C365.7188,1480.3518 351.9437,1426.0148 344.6325,1390.4893 " fill="none" id="CheckSMSCode-ValidateInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="343.6005,1385.3879,341.4648,1395.0024,344.5921,1390.2886,349.3059,1393.4159,343.6005,1385.3879" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="389" y="1519.3638">No code or invalid code</text><!--link CheckSMSCode to BasicInfoScreen--><path d="M649.1989,1657.285 C701.861,1644.6983 757,1618.948 757,1566.2969 C757,393.7969 757,393.7969 757,393.7969 C757,329.8394 558.2386,307.0225 443.7801,299.1855 " fill="none" id="CheckSMSCode-BasicInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="438.7322,298.8458,447.4433,303.441,443.7209,299.1815,447.9805,295.4591,438.7322,298.8458" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="758" y="938.3638">Validation key expired</text><!--link CheckSMSCode to CheckIfValidatedEmailIsRequired--><path d="M610.3808,1694.4248 C616.613,1699.4688 622.1092,1705.3917 626,1712.2969 C629.709,1718.8794 627.6036,1721.9135 626,1729.2969 C618.9505,1761.7548 617.902,1773.2405 595,1797.2969 C581.6985,1811.2689 564.554,1822.6635 547.4099,1831.6945 " fill="none" id="CheckSMSCode-CheckIfValidatedEmailIsRequired" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="542.5777,1834.1792,552.4107,1833.621,547.0243,1831.8928,548.7525,1826.5064,542.5777,1834.1792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="635.5" y="1769.3638">SMSCode is valid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="623" y="1784.4966">Number is confirmed</text><!--link CheckSMSCode to CheckIfPhoneValidationIsSkipped--><path d="M471.4521,1694.3127 C458.1134,1699.9276 447.2763,1706.0744 443,1712.2969 C436.8572,1721.2352 438.232,1732.3148 442.1994,1742.511 " fill="none" id="CheckSMSCode-CheckIfPhoneValidationIsSkipped" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="444.187,1747.1227,444.2979,1737.2744,442.2079,1742.531,436.9513,1740.441,444.187,1747.1227" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="444" y="1725.3638">User skipped SMS validation</text><!--link CheckIfPhoneValidationIsSkipped to CheckIfValidatedEmailIsRequired--><path d="M465.0494,1797.4609 C466.6456,1807.3802 468.4923,1818.8564 470.1583,1829.2092 " fill="none" id="CheckIfPhoneValidationIsSkipped-CheckIfValidatedEmailIsRequired" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470.9597,1834.1894,473.4789,1824.6682,470.1653,1829.2529,465.5805,1825.9393,470.9597,1834.1894" style="stroke: #A80036; stroke-width: 1.0;"/><!--link CheckIfValidatedEmailIsRequired to CheckIfEmailIsValidated--><path d="M360.1011,1884.3402 C345.6151,1889.6043 334.0749,1895.6164 329,1902.2969 C322.6502,1910.6558 320.6525,1921.4461 320.7277,1931.9154 " fill="none" id="CheckIfValidatedEmailIsRequired-CheckIfEmailIsValidated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="320.9212,1937.017,324.5771,1927.8718,320.7316,1932.0206,316.5828,1928.1751,320.9212,1937.017" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="330" y="1915.3638">Validated email required</text><!--link CheckIfEmailIsValidated to ValidateInfoScreen--><path d="M312.8522,1936.8438 C304.177,1915.3314 295,1886.2133 295,1859.2969 C295,1463.2969 295,1463.2969 295,1463.2969 C295,1437.7528 305.1829,1411.0206 315.6381,1390.3058 " fill="none" id="CheckIfEmailIsValidated-ValidateInfoScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318.0106,1385.7122,310.3265,1391.8729,315.716,1390.1546,317.4343,1395.5442,318.0106,1385.7122" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="296" y="1673.8638">Email not validated yet</text><!--link CheckIfValidatedEmailIsRequired to DeleteRegistrationSessionValues--><path d="M484.8847,1884.387 C497.4093,1920.54 514.2883,1988.2154 487,2036.2969 C483.9121,2041.7378 479.8323,2046.5636 475.1807,2050.8275 " fill="none" id="CheckIfValidatedEmailIsRequired-DeleteRegistrationSessionValues" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="471.1481,2054.2783,480.5869,2051.466,474.9471,2051.0274,475.3856,2045.3876,471.1481,2054.2783" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="502" y="1973.8638">Validated email not required</text><!--link CheckIfEmailIsValidated to DeleteRegistrationSessionValues--><path d="M348.5231,2001.4077 C356.1465,2012.7199 365.1102,2025.3401 374,2036.2969 C377.7572,2040.9277 381.9084,2045.6599 386.084,2050.2116 " fill="none" id="CheckIfEmailIsValidated-DeleteRegistrationSessionValues" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="389.5892,2053.9863,386.3963,2044.6693,386.1869,2050.3223,380.534,2050.1129,389.5892,2053.9863" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="375" y="2032.3638">Email is validated</text><!--link DeleteRegistrationSessionValues to *end*RegisterScreen--><path d="M415,2104.4935 C415,2124.0774 415,2150.5981 415,2167.0675 " fill="none" id="DeleteRegistrationSessionValues-*end*RegisterScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="415,2172.2428,419,2163.2428,415,2167.2428,411,2163.2428,415,2172.2428" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="416" y="2135.3638">Set redirectparams value in registration session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="466" y="2150.4966">Save registration session cookie</text><!--link *start to RegisterScreen--><path d="M469,28.1096 C469,38.7866 469,57.5786 469,82.8435 " fill="none" id="*start-RegisterScreen" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="469,87.9823,473,78.9823,469,82.9823,465,78.9823,469,87.9823" style="stroke: #A80036; stroke-width: 1.0;"/><!--link RegisterScreen to UserIsLoggedIn--><path d="M469,2207.3774 C469,2229.2655 469,2247.5294 469,2261.4205 " fill="none" id="RegisterScreen-UserIsLoggedIn" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="469,2266.7194,473,2257.7194,469,2261.7194,465,2257.7194,469,2266.7194" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserIsLoggedIn to *end--><path d="M469,2317.4583 C469,2334.6886 469,2356.8909 469,2371.5165 " fill="none" id="UserIsLoggedIn-*end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="469,2376.5388,473,2367.5388,469,2371.5388,465,2367.5388,469,2376.5388" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml current_registration_flow

[*] - -> RegisterScreen
state RegisterScreen {
    [*] - -> BasicInfoScreen
    BasicInfoScreen: Firstname Lastname\nphonenumber\nemailaddress\npassword\nconfirmpassword
    BasicInfoScreen - -> BasicInfoValid
    BasicInfoValid: Check:\n\tFirstname\n\tLastname\n\tphonenumber\n\temailaddress
    BasicInfoValid -up- -> BasicInfoScreen: Basic info not valid

    BasicInfoValid -d- -> GetRegistrationSession: Basic info valid\nGenerate username
    GetRegistrationSession: Creates new if it does not exist

    GetRegistrationSession - -> LoadUserFromDb
    LoadUserFromDb: Use username from registrationsession
   
    LoadUserFromDb - -> CreateNewUserObject: user not found
    LoadUserFromDb - -> UpdateUserObject: user exists

    CreateNewUserObject - -> UpsertUsernamePassword
    UpdateUserObject - -> UpsertUsernamePassword

    UpsertUsernamePassword - -> BasicInfoScreen: Password invalid
    
    UpsertUsernamePassword - -> CheckValidatingPhone
    CheckValidatingPhone: Start phone validation if number from\nbasic info screen does not match number\nfrom registration session cookie and\nset cookie value to new number

    CheckValidatingPhone - -> CheckValidatingEmail
    CheckValidatingEmail: Start email validation if email from\nbasic info screen does not match email\nfrom registration session cookie and\nset cookie value to new number

    CheckValidatingEmail - -> ValidateInfoScreen: Save registration session cookie
    ValidateInfoScreen: phone code\nemail verification status

    ValidateInfoScreen - -> BasicInfoScreen: Basic info button

    ValidateInfoScreen - -> GetRegistrationSessionCookie: Register button

    GetRegistrationSessionCookie - -> BasicInfoScreen: Registration session expired

    GetRegistrationSessionCookie - -> CheckIfPhoneIsValidated: Load saved values from cookie

    CheckIfPhoneIsValidated - -> CheckSMSCode: phone not validated yet
    CheckSMSCode: From the validate info form
    CheckSMSCode - -> ValidateInfoScreen: No code or invalid code
    CheckSMSCode - -> BasicInfoScreen: Validation key expired
    CheckSMSCode - -> CheckIfValidatedEmailIsRequired: SMSCode is valid\nNumber is confirmed
    CheckSMSCode - -> CheckIfPhoneValidationIsSkipped: User skipped SMS validation
    CheckIfPhoneValidationIsSkipped - -> CheckIfValidatedEmailIsRequired
    IfValidatedEmailIsRequired: No clientid query param\nuser:validated:email scope requested\nrequirevalidatedemail queryparam set with non empty value
    CheckIfValidatedEmailIsRequired - -> CheckIfEmailIsValidated: Validated email required 
    CheckIfEmailIsValidated: Must be validated by\npressing the button in the email
    CheckIfEmailIsValidated -right- -> ValidateInfoScreen: Email not validated yet
    CheckIfValidatedEmailIsRequired - -> DeleteRegistrationSessionValues: Validated email not required
    CheckIfEmailIsValidated - -> DeleteRegistrationSessionValues: Email is validated
    DeleteRegistrationSessionValues - -> [*]: Set redirectparams value in registration session\nSave registration session cookie
}

RegisterScreen - -> UserIsLoggedIn
UserIsLoggedIn - -> [*]

@enduml

PlantUML version 1.2019.03(Sun Mar 10 13:04:44 EET 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 11.0.2+9-LTS
Operating System: Linux
OS Version: 4.15.0-46-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>